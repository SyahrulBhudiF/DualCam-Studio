import{r as i,v as q,z as M,x as n,A as R,B as D,j as e,D as T,E as P}from"./main-DZWvjlLQ.js";import{u as B}from"./useSuspenseQuery-qEofHi1q.js";import{u as _,L as d}from"./label-B01KzJ1v.js";import{u}from"./useMutation-D6MBcEm7.js";import{u as k,g as E,e as A,h as K,i as O,D as I,f as b,c as z,d as L,T as G}from"./checkbox-BQsVdztE.js";import{B as m}from"./button-DhTWMI0i.js";import{f as H,l as V,g as J,h as U,i as W}from"./index-YHAXHqCs.js";import{M as X}from"./main-Bsmmwh1x.js";import{I as Y}from"./input-CBEPYGHf.js";import{T as Z,S as $}from"./textarea-CZ4R24pj.js";import{g as ee,c as te,P as se}from"./columns-DCSBL4B_.js";import"./utils-CwvXAYlB.js";import"./badge-Ohhm4MUd.js";import"./command-BJEtlO-u.js";import"./index-COLG3_It.js";import"./select-DCsT-fDP.js";import"./index-xaBr0Lpv.js";import"./dropdown-menu-CWLiXjqn.js";import"./index-tXSsdQnT.js";import"./schemas-B8WLmFja.js";function ae({data:o}){const[v,C]=i.useState([]),[y,h]=i.useState({}),[S,f]=i.useState(""),[N,g]=i.useState(!1),l=q(),c=u({mutationFn:M,onSuccess:()=>{l.invalidateQueries({queryKey:["admin","questionnaires"]}),g(!1),r.reset(),n.success("Questionnaire created successfully")},onError:()=>{n.error("Failed to create questionnaire")}}),w=u({mutationFn:R,onSuccess:()=>{l.invalidateQueries({queryKey:["admin","questionnaires"]}),h({}),n.success("Questionnaire deleted successfully")},onError:()=>{n.error("Failed to delete questionnaire")}}),F=u({mutationFn:D,onSuccess:()=>{l.invalidateQueries({queryKey:["admin","questionnaires"]}),r.reset(),n.success("Questionnaire updated successfully")},onError:()=>{n.error("Failed to update questionnaire")}}),p=ee(()=>{},t=>F.mutate({data:{id:t.id,is_active:!t.is_active}})),a=k({data:o,columns:p,state:{sorting:v,rowSelection:y,globalFilter:S},onSortingChange:C,onRowSelectionChange:h,onGlobalFilterChange:f,getCoreRowModel:O(),getSortedRowModel:K(),getFilteredRowModel:A(),getPaginationRowModel:E()}),r=_({defaultValues:{title:"",description:"",is_active:!1},validators:{onSubmit:({value:t})=>{const s=te.safeParse(t);if(!s.success)return s.error.issues.reduce((x,j)=>{const Q=j.path[0];return x[Q]=j.message,x},{})}},onSubmit:async({value:t})=>{await c.mutateAsync({data:{title:t.title,description:t.description||null,is_active:t.is_active}})}});return e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Questionnaires"}),e.jsxs(H,{open:N,onOpenChange:g,children:[e.jsx(V,{asChild:!0,children:e.jsxs(m,{size:"sm",className:"cursor-pointer",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Add Questionnaire"]})}),e.jsxs(J,{children:[e.jsx(U,{children:e.jsx(W,{children:"Create Questionnaire"})}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),r.handleSubmit()},className:"space-y-4",children:[e.jsx(r.Field,{name:"title",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:t.name,children:"Title"}),e.jsx(Y,{id:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:s=>t.handleChange(s.target.value)}),t.state.meta.errors?e.jsx("p",{className:"text-destructive text-sm",children:t.state.meta.errors.join(", ")}):null]})}),e.jsx(r.Field,{name:"description",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:t.name,children:"Description"}),e.jsx(Z,{id:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:s=>t.handleChange(s.target.value)})]})}),e.jsx(r.Field,{name:"is_active",children:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{id:t.name,checked:t.state.value,onCheckedChange:t.handleChange}),e.jsx(d,{htmlFor:t.name,children:"Set as Active"})]})}),e.jsx(m,{type:"submit",className:"w-full cursor-pointer",disabled:c.isPending,children:c.isPending?"Creating...":"Create"})]})]})]})]}),e.jsx(I,{table:a,searchKey:"title"}),e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:a.getHeaderGroups().map(t=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:t.headers.map(s=>e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",children:s.isPlaceholder?null:b(s.column.columnDef.header,s.getContext())},s.id))},t.id))}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:a.getRowModel().rows?.length?a.getRowModel().rows.map(t=>e.jsx("tr",{"data-state":t.getIsSelected()&&"selected",className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:t.getVisibleCells().map(s=>e.jsx("td",{className:"p-4 align-middle [&:has([role=checkbox])]:pr-0",children:b(s.column.columnDef.cell,s.getContext())},s.id))},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:p.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(z,{table:a}),e.jsx(L,{table:a,entityName:"questionnaire",children:e.jsxs(m,{variant:"destructive",size:"sm",className:"h-8 cursor-pointer",onClick:()=>{const t=a.getFilteredSelectedRowModel().rows.map(s=>s.original.id);w.mutate({data:{ids:t}})},children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," Delete Selected"]})})]})}const re=T({queryKey:["admin","questionnaires"],queryFn:()=>P()});function we(){const o=B(re);return e.jsx(ae,{data:o.data})}export{we as component};

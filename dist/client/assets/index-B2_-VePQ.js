import{c as K,j as e,L as Q,r as h,t as H,v as z,w as $,x as R,y as G}from"./main-DZWvjlLQ.js";import{u as L}from"./useMutation-D6MBcEm7.js";import{C as M,P as F,a as k,b as D,u as O,D as U,f as A,c as X,d as Y,T as J,g as W,e as Z,h as ee,i as se}from"./checkbox-BQsVdztE.js";import{B as a}from"./button-DhTWMI0i.js";import{M as te}from"./main-Bsmmwh1x.js";import{B as w}from"./badge-Ohhm4MUd.js";import{V as ae,f as b}from"./format-CjtGFxja.js";import{E as le}from"./eye-Cc4_uuJc.js";import{C as I,a as P,E as oe}from"./calendar-6rLOrFiO.js";import{S as V,a as T,b as _,c as E,d as y}from"./select-DCsT-fDP.js";import{c as q}from"./utils-CwvXAYlB.js";import{X as re}from"./index-YHAXHqCs.js";import"./command-BJEtlO-u.js";import"./index-COLG3_It.js";import"./input-CBEPYGHf.js";import"./dropdown-menu-CWLiXjqn.js";import"./index-tXSsdQnT.js";import"./index-xaBr0Lpv.js";import"./xlsx-BsqxREE8.js";import"./chevron-right-BziTW__y.js";const ne=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],x=K("arrow-up-down",ne);const ie=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ce=K("funnel",ie);function de(){return[{id:"select",header:({table:s})=>e.jsx(M,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:l=>s.toggleAllPageRowsSelected(!!l),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(M,{checked:s.getIsSelected(),onCheckedChange:l=>s.toggleSelected(!!l),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"profile.name",id:"name",header:({column:s})=>e.jsxs(a,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"cursor-pointer",children:["Name",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.original.profile?.name??"-"})},{accessorKey:"profile.class",id:"class",header:({column:s})=>e.jsxs(a,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"cursor-pointer",children:["Class",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx(w,{variant:"outline",children:s.original.profile?.class??"-"})},{accessorKey:"profile.nim",id:"nim",header:"NIM",cell:({row:s})=>e.jsx("span",{className:"text-muted-foreground",children:s.original.profile?.nim??"-"})},{accessorKey:"questionnaireTitle",id:"questionnaire",header:({column:s})=>e.jsxs(a,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"cursor-pointer",children:["Questionnaire",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"max-w-[200px] truncate",children:s.original.questionnaireTitle??"-"})},{accessorKey:"totalScore",id:"score",header:({column:s})=>e.jsxs(a,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"cursor-pointer",children:["Score",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx(w,{variant:"secondary",children:s.original.totalScore})},{accessorKey:"videoPath",id:"video",header:"Video",cell:({row:s})=>s.original.videoPath&&s.original.videoPath!=="null"?e.jsxs(w,{variant:"default",className:"gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),"Yes"]}):e.jsx(w,{variant:"outline",children:"No"})},{accessorKey:"createdAt",id:"date",header:({column:s})=>e.jsxs(a,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"cursor-pointer",children:["Date",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"text-muted-foreground text-sm",children:b(new Date(s.original.createdAt),"dd MMM yyyy HH:mm")})},{id:"actions",header:"Actions",cell:({row:s})=>e.jsx(Q,{to:"/admin/responses/$responseId",params:{responseId:s.original.id},children:e.jsxs(a,{variant:"ghost",size:"sm",className:"cursor-pointer",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"View"]})})}]}const i="__all__";function me({filterOptions:s,onFilterApply:l,onFilterClear:C}){const[g,p]=h.useState(i),[c,j]=h.useState(i),[d,f]=h.useState(void 0),[o,N]=h.useState(void 0),u=L({mutationFn:H,onSuccess:t=>{l(t)}}),S=()=>{u.mutate({data:{questionnaireId:g!==i?g:void 0,className:c!==i?c:void 0,startDate:d?d.toISOString():void 0,endDate:o?o.toISOString():void 0}})},v=()=>{p(i),j(i),f(void 0),N(void 0),C()},m=g!==i||c!==i||d||o;return e.jsxs("div",{className:"flex flex-wrap items-center gap-3 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters:"})]}),e.jsxs(V,{value:g,onValueChange:p,children:[e.jsx(T,{className:"w-[200px]",children:e.jsx(_,{placeholder:"All Questionnaires"})}),e.jsxs(E,{children:[e.jsx(y,{value:i,children:"All Questionnaires"}),s.questionnaires.map(t=>e.jsx(y,{value:t.id,children:t.title},t.id))]})]}),e.jsxs(V,{value:c,onValueChange:j,children:[e.jsx(T,{className:"w-[150px]",children:e.jsx(_,{placeholder:"All Classes"})}),e.jsxs(E,{children:[e.jsx(y,{value:i,children:"All Classes"}),s.classes.map(t=>e.jsx(y,{value:t,children:t},t))]})]}),e.jsxs(F,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(a,{variant:"outline",className:q("w-[140px] justify-start text-left font-normal",!d&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),d?b(d,"dd/MM/yyyy"):"Start Date"]})}),e.jsx(D,{className:"w-auto p-0",align:"start",children:e.jsx(P,{mode:"single",selected:d,onSelect:f,initialFocus:!0})})]}),e.jsxs(F,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(a,{variant:"outline",className:q("w-[140px] justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),o?b(o,"dd/MM/yyyy"):"End Date"]})}),e.jsx(D,{className:"w-auto p-0",align:"start",children:e.jsx(P,{mode:"single",selected:o,onSelect:N,initialFocus:!0})})]}),e.jsx(a,{onClick:S,disabled:u.isPending,className:"cursor-pointer",children:u.isPending?"Filtering...":"Apply"}),m&&e.jsxs(a,{variant:"ghost",size:"sm",onClick:v,className:"cursor-pointer",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Clear"]})]})}function he({data:s,filterOptions:l}){const[C,g]=h.useState([]),[p,c]=h.useState({}),[j,d]=h.useState(""),[f,o]=h.useState(null),N=z(),u=L({mutationFn:$,onSuccess:()=>{N.invalidateQueries({queryKey:["admin","responses"]}),c({}),R.success("Responses deleted successfully")},onError:()=>{R.error("Failed to delete responses")}}),S=de(),v=f??s,m=O({data:v,columns:S,state:{sorting:C,rowSelection:p,globalFilter:j},onSortingChange:g,onRowSelectionChange:c,onGlobalFilterChange:d,getCoreRowModel:se(),getSortedRowModel:ee(),getFilteredRowModel:Z(),getPaginationRowModel:W()}),t=r=>{o(r),c({})},B=()=>{o(null),c({})};return e.jsxs(te,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Responses"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage all questionnaire responses"})]}),e.jsx(oe,{responses:v})]}),e.jsx(me,{filterOptions:l,onFilterApply:t,onFilterClear:B}),e.jsx(U,{table:m,searchKey:"name"}),e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:m.getHeaderGroups().map(r=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:r.headers.map(n=>e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",children:n.isPlaceholder?null:A(n.column.columnDef.header,n.getContext())},n.id))},r.id))}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:m.getRowModel().rows?.length?m.getRowModel().rows.map(r=>e.jsx("tr",{"data-state":r.getIsSelected()&&"selected",className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:r.getVisibleCells().map(n=>e.jsx("td",{className:"p-4 align-middle [&:has([role=checkbox])]:pr-0",children:A(n.column.columnDef.cell,n.getContext())},n.id))},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:S.length,className:"h-24 text-center",children:"No responses found."})})})]})}),e.jsx(X,{table:m}),e.jsx(Y,{table:m,entityName:"response",children:e.jsxs(a,{variant:"destructive",size:"sm",className:"h-8 cursor-pointer",onClick:()=>{const r=m.getFilteredSelectedRowModel().rows.map(n=>n.original.id);u.mutate({data:{ids:r}})},disabled:u.isPending,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),u.isPending?"Deleting...":"Delete Selected"]})})]})}function Pe(){const{responses:s,filterOptions:l}=G.useLoaderData();return e.jsx(he,{data:s,filterOptions:l})}export{Pe as component};

import{c as w,r as s,j as t}from"./main-DZWvjlLQ.js";import{R as y,I,a as k}from"./index-BIv2WHLP.js";import{c as p}from"./utils-CwvXAYlB.js";const j=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],S=w("circle",j),x=s.forwardRef(({onReady:a},d)=>{const m=s.useRef(null),c=s.useRef(null),l=s.useRef([]),r=e=>{c.current&&c.current.readyState===WebSocket.OPEN?c.current.send(e):l.current.push(e)};return s.useImperativeHandle(d,()=>({startRecording:e=>{const o=JSON.stringify({action:"START",...e});r(o)},stopRecording:()=>{const e=JSON.stringify({action:"STOP"});r(e)}})),s.useEffect(()=>{const e=m.current;if(!e)return;const o=e.getContext("2d",{alpha:!1});if(!o)return;c.current=new WebSocket("ws://localhost:8080");const v=new Image;return c.current.onopen=()=>{for(;l.current.length>0;){const f=l.current.shift();f&&c.current?.send(f)}a&&a()},c.current.onmessage=f=>{const n=f.data,u=URL.createObjectURL(n);v.onload=()=>{o.drawImage(v,0,0,640,480),URL.revokeObjectURL(u)},v.src=u},()=>{c.current&&c.current.close()}},[a]),t.jsx("canvas",{ref:m,width:640,height:480,className:"w-full h-full object-contain bg-black"})});x.displayName="RealSenseCanvas";function M({videoDevices:a,deviceIdMain:d,setDeviceIdMain:m,deviceIdSec:c,setDeviceIdSec:l,videoRefMain:r,videoRefSec:e,realSenseRef:o,isRecording:v,onSecReady:f}){return t.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-row gap-4 z-50 items-end",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("div",{className:"bg-white/90 dark:bg-slate-900/90 backdrop-blur px-2 py-1 rounded shadow text-[10px] font-bold text-center border border-slate-200 dark:border-slate-800 dark:text-slate-200",children:"Main Cam (Audio ON)"}),t.jsx("select",{className:"w-48 text-xs bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-800 rounded p-1 shadow-sm dark:text-slate-200",value:d,onChange:n=>m(n.target.value),children:a.map((n,u)=>t.jsx("option",{value:n.deviceId,children:n.label||`Cam ${n.deviceId.substring(0,5)}...`},`main-${n.deviceId}-${u}`))}),t.jsx("div",{className:"w-48 h-36 bg-black rounded-lg overflow-hidden border-2 border-slate-300 dark:border-slate-700 shadow-xl",children:t.jsx("video",{ref:r,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"})})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("div",{className:"bg-blue-100/90 dark:bg-blue-950/90 backdrop-blur px-2 py-1 rounded shadow text-[10px] font-bold text-center text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-900",children:"Secondary / D415"}),t.jsxs("select",{className:"w-48 text-xs bg-white dark:bg-slate-900 border border-blue-300 dark:border-blue-900 rounded p-1 shadow-sm dark:text-slate-200",value:c,onChange:n=>l(n.target.value),children:[t.jsx("option",{value:"",children:"-- Turn Off --"}),t.jsx("option",{value:"ws-realsense",className:"font-bold text-blue-600",children:"âš¡ RealSense (Lossless Rec)"}),a.map((n,u)=>t.jsxs("option",{value:n.deviceId,children:[u+1,". ",n.label||`Cam ${n.deviceId.substring(0,5)}...`]},`sec-${n.deviceId}-${u}`))]}),t.jsxs("div",{className:"w-48 h-36 bg-black rounded-lg overflow-hidden border-2 border-blue-500 shadow-xl relative group",children:[c==="ws-realsense"?t.jsx(x,{ref:o,onReady:f}):t.jsx("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),t.jsx("div",{className:`absolute top-2 left-2 px-2 py-0.5 bg-red-600 text-white text-[10px] font-bold rounded-full transition-opacity ${v?"opacity-100 animate-pulse":"opacity-0"}`,children:"REC"}),!c&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/50 text-xs",children:"No Signal"})]})]})]})}function E({className:a,...d}){return t.jsx(y,{"data-slot":"radio-group",className:p("grid gap-3",a),...d})}function O({className:a,...d}){return t.jsx(I,{"data-slot":"radio-group-item",className:p("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...d,children:t.jsx(k,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:t.jsx(S,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}const g=a=>new Promise(d=>{if(!a||a.state==="inactive"){d();return}a.onstop=()=>d(),a.stop()});function h(a=""){const[d,m]=s.useState(a),[c,l]=s.useState(!1),[r,e]=s.useState(null),o=s.useRef(null),v=s.useRef(null),f=s.useRef([]);return s.useEffect(()=>{o.current&&r&&(o.current.srcObject=r)},[r]),{deviceId:d,setDeviceId:m,isReady:c,setReady:l,stream:r,setStream:e,videoRef:o,recorderRef:v,chunksRef:f}}function T(){const[a,d]=s.useState([]),[m,c]=s.useState(!1),l=s.useRef(!1),r=h(""),e=h("ws-realsense"),o=s.useRef(null);s.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});const b=(await navigator.mediaDevices.enumerateDevices()).filter(R=>R.kind==="videoinput");d(b),b.length>0&&r.setDeviceId(b[0].deviceId)}catch(i){console.error(i)}})()},[]),s.useEffect(()=>r.deviceId?((async()=>{try{const i=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:r.deviceId},width:{ideal:640},height:{ideal:480}},audio:!0});r.setStream(i);const b=new MediaRecorder(i);r.chunksRef.current=[],b.ondataavailable=R=>{R.data.size>0&&r.chunksRef.current.push(R.data)},r.recorderRef.current=b,r.setReady(!0)}catch(i){console.error(i)}})(),()=>r.stream?.getTracks().forEach(i=>i.stop())):void 0,[r.deviceId]),s.useEffect(()=>{if(e.deviceId==="ws-realsense"){e.setReady(!0);return}return e.deviceId?((async()=>{try{const i=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.deviceId},width:{ideal:640},height:{ideal:480}},audio:!1});e.setStream(i);const b=new MediaRecorder(i,{mimeType:"video/webm"});e.chunksRef.current=[],b.ondataavailable=R=>{R.data.size>0&&e.chunksRef.current.push(R.data)},e.recorderRef.current=b,e.setReady(!0)}catch(i){console.error(i)}})(),()=>e.stream?.getTracks().forEach(i=>i.stop())):void 0},[e.deviceId]);const v=s.useCallback(u=>{l.current||(l.current=!0,r.recorderRef.current&&r.recorderRef.current.state==="inactive"&&(r.chunksRef.current=[],r.recorderRef.current.start(1e3)),e.deviceId==="ws-realsense"?o.current?.startRecording(u):e.recorderRef.current&&e.recorderRef.current.state==="inactive"&&(e.chunksRef.current=[],e.recorderRef.current.start(1e3)),c(!0),setTimeout(()=>{l.current=!1},500))},[e.deviceId]),f=s.useCallback(async()=>(await g(r.recorderRef.current),e.deviceId==="ws-realsense"?o.current?.stopRecording():await g(e.recorderRef.current),c(!1),l.current=!1,{blobMain:new Blob(r.chunksRef.current,{type:"video/webm"}),blobSec:e.deviceId!=="ws-realsense"?new Blob(e.chunksRef.current,{type:"video/webm"}):null}),[e.deviceId]),n=r.isReady&&(e.deviceId==="ws-realsense",e.isReady);return{videoDevices:a,isRecording:m,allReady:n,startRecording:v,stopRecording:f,deviceIdMain:r.deviceId,setDeviceIdMain:r.setDeviceId,videoRefMain:r.videoRef,streamMain:r.stream,deviceIdSec:e.deviceId,setDeviceIdSec:e.setDeviceId,videoRefSec:e.videoRef,streamSec:e.stream,secReady:e.isReady,setSecReady:e.setReady,realSenseRef:o}}export{M as C,E as R,O as a,T as u};

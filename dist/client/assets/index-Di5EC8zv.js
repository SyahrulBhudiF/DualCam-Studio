import{v as y,r as w,X as R,x as m,j as e,L as P,S as I,Y as T,Z as E,_ as K,D as C,$ as O,a0 as L}from"./main-DZWvjlLQ.js";import{u as f}from"./useSuspenseQuery-qEofHi1q.js";import{u as _,L as g}from"./label-B01KzJ1v.js";import{u as v}from"./useMutation-D6MBcEm7.js";import{u as k,g as V,e as z,h as G,i as H,D as U,f as F,c as $,d as X,T as Y}from"./checkbox-BQsVdztE.js";import{B as p}from"./button-DhTWMI0i.js";import{f as q,l as Z,g as A,h as D,i as Q}from"./index-YHAXHqCs.js";import{M as J}from"./main-Bsmmwh1x.js";import{I as j}from"./input-CBEPYGHf.js";import{d as W,P as ee,b as se,e as te}from"./columns-DCSBL4B_.js";import{A as re}from"./arrow-left-DXVb_zBZ.js";import{S as ae}from"./save-CCepbDEX.js";import"./utils-CwvXAYlB.js";import"./badge-Ohhm4MUd.js";import"./command-BJEtlO-u.js";import"./index-COLG3_It.js";import"./select-DCsT-fDP.js";import"./index-xaBr0Lpv.js";import"./dropdown-menu-CWLiXjqn.js";import"./index-tXSsdQnT.js";import"./schemas-B8WLmFja.js";const ne=se.omit({questionnaire_id:!0}),B=te.omit({question_id:!0});function oe({question:a}){const u=y(),o=v({mutationFn:I,onSuccess:()=>{u.invalidateQueries({queryKey:["admin","question",a.id]}),m.success("Question updated successfully")},onError:()=>{m.error("Failed to update question")}}),i=_({defaultValues:{question_text:a.question_text,order_number:a.order_number},validators:{onSubmit:({value:r})=>{const s=ne.safeParse(r);if(!s.success)return s.error.issues.reduce((t,n)=>{const d=n.path[0];return t[d]=n.message,t},{})}},onSubmit:async({value:r})=>{await o.mutateAsync({data:{id:a.id,question_text:r.question_text,order_number:Number(r.order_number)}})}});return e.jsxs("form",{onSubmit:r=>{r.preventDefault(),r.stopPropagation(),i.handleSubmit()},className:"space-y-4 rounded-lg border p-4 max-w-2xl",children:[e.jsx(i.Field,{name:"order_number",children:r=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"order_number",children:"Order"}),e.jsx(j,{id:"order_number",type:"number",className:"max-w-[100px]",value:String(r.state.value),onBlur:r.handleBlur,onChange:s=>r.handleChange(Number(s.target.value))}),r.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:r.state.meta.errors.join(", ")}):null]})}),e.jsx(i.Field,{name:"question_text",children:r=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"question_text",children:"Question"}),e.jsx(j,{id:"question_text",value:r.state.value,onBlur:r.handleBlur,onChange:s=>r.handleChange(s.target.value)}),r.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:r.state.meta.errors.join(", ")}):null]})}),e.jsxs(p,{type:"submit",disabled:o.isPending,className:"cursor-pointer",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Save Question"]})]})}function ie({questionId:a,onSuccess:u}){const o=y(),i=v({mutationFn:T,onSuccess:()=>{o.invalidateQueries({queryKey:["admin","answers",a]}),u(),r.reset(),m.success("Answer created successfully")},onError:()=>{m.error("Failed to create answer")}}),r=_({defaultValues:{answer_text:"",score:0},validators:{onSubmit:({value:s})=>{const t=B.safeParse(s);if(!t.success)return t.error.issues.reduce((n,d)=>{const x=d.path[0];return n[x]=d.message,n},{})}},onSubmit:async({value:s})=>{await i.mutateAsync({data:{question_id:a,answer_text:s.answer_text,score:Number(s.score)}})}});return e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),r.handleSubmit()},className:"space-y-4",children:[e.jsx(r.Field,{name:"answer_text",children:s=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"answer_text",children:"Answer Text"}),e.jsx(j,{id:"answer_text",value:s.state.value,onBlur:s.handleBlur,onChange:t=>s.handleChange(t.target.value)}),s.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:s.state.meta.errors.join(", ")}):null]})}),e.jsx(r.Field,{name:"score",children:s=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"score",children:"Score"}),e.jsx(j,{id:"score",type:"number",value:String(s.state.value),onBlur:s.handleBlur,onChange:t=>s.handleChange(Number(t.target.value))}),s.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:s.state.meta.errors.join(", ")}):null]})}),e.jsx(p,{type:"submit",className:"w-full cursor-pointer",disabled:i.isPending,children:"Create"})]})}function le({answer:a,questionId:u,onSuccess:o}){const i=y(),r=v({mutationFn:E,onSuccess:()=>{i.invalidateQueries({queryKey:["admin","answers",u]}),o(),s.reset(),m.success("Answer updated successfully")},onError:()=>{m.error("Failed to update answer")}}),s=_({defaultValues:{answer_text:a.answer_text,score:a.score},validators:{onSubmit:({value:t})=>{const n=B.safeParse(t);if(!n.success)return n.error.issues.reduce((d,x)=>{const b=x.path[0];return d[b]=x.message,d},{})}},onSubmit:async({value:t})=>{await r.mutateAsync({data:{id:a.id,answer_text:t.answer_text,score:Number(t.score)}})}});return e.jsxs("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),s.handleSubmit()},className:"space-y-4",children:[e.jsx(s.Field,{name:"answer_text",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit_answer_text",children:"Answer Text"}),e.jsx(j,{id:"edit_answer_text",value:t.state.value,onBlur:t.handleBlur,onChange:n=>t.handleChange(n.target.value)}),t.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:t.state.meta.errors.join(", ")}):null]})}),e.jsx(s.Field,{name:"score",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit_score",children:"Score"}),e.jsx(j,{id:"edit_score",type:"number",value:String(t.state.value),onBlur:t.handleBlur,onChange:n=>t.handleChange(Number(n.target.value))}),t.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:t.state.meta.errors.join(", ")}):null]})}),e.jsx(p,{type:"submit",className:"w-full cursor-pointer",disabled:r.isPending,children:"Update"})]})}function ue({question:a,answers:u}){const o=y(),[i,r]=w.useState([]),[s,t]=w.useState({}),[n,d]=w.useState(""),[x,b]=w.useState(!1),[N,S]=w.useState(null),M=v({mutationFn:R,onSuccess:()=>{o.invalidateQueries({queryKey:["admin","answers",a.id]}),t({}),m.success("Answers deleted successfully")},onError:()=>{m.error("Failed to delete answers")}}),h=k({data:u,columns:W(S),state:{sorting:i,rowSelection:s,globalFilter:n},onSortingChange:r,onRowSelectionChange:t,onGlobalFilterChange:d,getCoreRowModel:H(),getSortedRowModel:G(),getFilteredRowModel:z(),getPaginationRowModel:V()});return e.jsxs(J,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"outline",size:"icon",asChild:!0,children:e.jsx(P,{to:"/admin/questionnaires/$questionnaireId",params:{questionnaireId:a.questionnaire_id},children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Question Details"})]}),e.jsx(oe,{question:a}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Answers"}),e.jsxs(q,{open:x,onOpenChange:b,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(p,{size:"sm",className:"cursor-pointer",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Add Answer"]})}),e.jsxs(A,{children:[e.jsx(D,{children:e.jsx(Q,{children:"Add Answer"})}),e.jsx(ie,{questionId:a.id,onSuccess:()=>b(!1)})]})]}),e.jsx(q,{open:!!N,onOpenChange:c=>!c&&S(null),children:e.jsxs(A,{children:[e.jsx(D,{children:e.jsx(Q,{children:"Edit Answer"})}),N&&e.jsx(le,{answer:N,questionId:a.id,onSuccess:()=>S(null)})]})})]}),e.jsx(U,{table:h,searchKey:"answer_text"}),e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:h.getHeaderGroups().map(c=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50",children:c.headers.map(l=>e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:l.isPlaceholder?null:F(l.column.columnDef.header,l.getContext())},l.id))},c.id))}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:h.getRowModel().rows.map(c=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50",children:c.getVisibleCells().map(l=>e.jsx("td",{className:"p-4 align-middle",children:F(l.column.columnDef.cell,l.getContext())},l.id))},c.id))})]})}),e.jsx($,{table:h}),e.jsx(X,{table:h,entityName:"answer",children:e.jsxs(p,{variant:"destructive",size:"sm",className:"h-8",onClick:()=>{const c=h.getFilteredSelectedRowModel().rows.map(l=>l.original.id);M.mutate({data:{ids:c}})},children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," Delete Selected"]})})]})]})}function Qe(){const a=K.useParams(),u=f(C({queryKey:["admin","question",a.questionId],queryFn:()=>O({data:a.questionId})})),o=f(C({queryKey:["admin","answers",a.questionId],queryFn:()=>L({data:a.questionId})}));return e.jsx(ue,{question:u.data,answers:o.data})}export{Qe as component};

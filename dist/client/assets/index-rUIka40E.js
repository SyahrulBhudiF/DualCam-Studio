import{r as N,v as S,P as L,x,j as e,Q as O,S as k,T as H,B as z,L as w,U as G,D as T,V as U,W}from"./main-DZWvjlLQ.js";import{u as D}from"./useSuspenseQuery-qEofHi1q.js";import{u as F,L as g}from"./label-B01KzJ1v.js";import{u as Y}from"./useQuery-2Qr4vTpQ.js";import{u as C}from"./useMutation-D6MBcEm7.js";import{M as $}from"./main-Bsmmwh1x.js";import{B as q}from"./badge-Ohhm4MUd.js";import{B as b}from"./button-DhTWMI0i.js";import{I as f}from"./input-CBEPYGHf.js";import{T as J,S as X}from"./textarea-CZ4R24pj.js";import{f as Z,g as ee,h as Q,i as _,T as se,a as te,b as B,c as j,d as ae,e as p}from"./tabs-DwpOdH4M.js";import{a as re,P as ne,b as ie,c as oe}from"./columns-DCSBL4B_.js";import{u as le,g as de,e as ue,h as ce,i as me,D as he,f as M,c as xe,d as je,T as pe}from"./checkbox-BQsVdztE.js";import{f as R,l as ge,g as P,h as A,i as E}from"./index-YHAXHqCs.js";import{A as be}from"./arrow-left-DXVb_zBZ.js";import{S as ve}from"./save-CCepbDEX.js";import{V as ye,f as Ne}from"./format-CjtGFxja.js";import{E as fe}from"./eye-Cc4_uuJc.js";import"./utils-CwvXAYlB.js";import"./index-COLG3_It.js";import"./index-xaBr0Lpv.js";import"./index-tXSsdQnT.js";import"./schemas-B8WLmFja.js";import"./dropdown-menu-CWLiXjqn.js";import"./command-BJEtlO-u.js";import"./select-DCsT-fDP.js";const I=ie.omit({questionnaire_id:!0});function qe({questionnaireId:r,onSuccess:i}){const l=S(),c=C({mutationFn:O,onSuccess:()=>{l.invalidateQueries({queryKey:["admin","questions",r]}),i(),o.reset(),x.success("Question created successfully")},onError:()=>{x.error("Failed to create question")}}),o=F({defaultValues:{question_text:"",order_number:0},validators:{onSubmit:({value:t})=>{const a=I.safeParse(t);if(!a.success)return a.error.issues.reduce((s,n)=>{const d=n.path[0];return s[d]=n.message,s},{})}},onSubmit:async({value:t})=>{await c.mutateAsync({data:{questionnaire_id:r,question_text:t.question_text,order_number:Number(t.order_number)}})}});return e.jsxs("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),o.handleSubmit()},className:"space-y-4",children:[e.jsx(o.Field,{name:"order_number",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"order_number",children:"Order"}),e.jsx(f,{id:"order_number",type:"number",value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(Number(a.target.value))}),t.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:t.state.meta.errors.join(", ")}):null]})}),e.jsx(o.Field,{name:"question_text",children:t=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"question_text",children:"Question Text"}),e.jsx(f,{id:"question_text",value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(a.target.value)}),t.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:t.state.meta.errors.join(", ")}):null]})}),e.jsx(b,{type:"submit",className:"w-full cursor-pointer",disabled:c.isPending,children:"Create"})]})}function Se({question:r,questionnaireId:i,onSuccess:l}){const c=S(),o=C({mutationFn:k,onSuccess:()=>{c.invalidateQueries({queryKey:["admin","questions",i]}),l(),t.reset(),x.success("Question updated successfully")},onError:()=>{x.error("Failed to update question")}}),t=F({defaultValues:{question_text:r.question_text,order_number:r.order_number},validators:{onSubmit:({value:a})=>{const s=I.safeParse(a);if(!s.success)return s.error.issues.reduce((n,d)=>{const h=d.path[0];return n[h]=d.message,n},{})}},onSubmit:async({value:a})=>{await o.mutateAsync({data:{id:r.id,question_text:a.question_text,order_number:Number(a.order_number)}})}});return e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),t.handleSubmit()},className:"space-y-4",children:[e.jsx(t.Field,{name:"order_number",children:a=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit_order_number",children:"Order"}),e.jsx(f,{id:"edit_order_number",type:"number",value:String(a.state.value),onBlur:a.handleBlur,onChange:s=>a.handleChange(Number(s.target.value))}),a.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:a.state.meta.errors.join(", ")}):null]})}),e.jsx(t.Field,{name:"question_text",children:a=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit_question_text",children:"Question Text"}),e.jsx(f,{id:"edit_question_text",value:a.state.value,onBlur:a.handleBlur,onChange:s=>a.handleChange(s.target.value)}),a.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:a.state.meta.errors.join(", ")}):null]})}),e.jsx(b,{type:"submit",className:"w-full cursor-pointer",disabled:o.isPending,children:"Update"})]})}function Ce({data:r,questionnaireId:i}){const[l,c]=N.useState([]),[o,t]=N.useState({}),[a,s]=N.useState(""),[n,d]=N.useState(!1),[h,y]=N.useState(null),V=S(),K=C({mutationFn:L,onSuccess:()=>{V.invalidateQueries({queryKey:["admin","questions",i]}),t({}),x.success("Question deleted successfully")},onError:()=>{x.error("Failed to delete question")}}),v=le({data:r,columns:re(i,y),state:{sorting:l,rowSelection:o,globalFilter:a},onSortingChange:c,onRowSelectionChange:t,onGlobalFilterChange:s,getCoreRowModel:me(),getSortedRowModel:ce(),getFilteredRowModel:ue(),getPaginationRowModel:de()});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Questions"}),e.jsxs(R,{open:n,onOpenChange:d,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{size:"sm",className:"cursor-pointer",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Add Question"]})}),e.jsxs(P,{children:[e.jsx(A,{children:e.jsx(E,{children:"Add Question"})}),e.jsx(qe,{questionnaireId:i,onSuccess:()=>d(!1)})]})]}),e.jsx(R,{open:!!h,onOpenChange:m=>!m&&y(null),children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsx(E,{children:"Edit Question"})}),h&&e.jsx(Se,{question:h,questionnaireId:i,onSuccess:()=>y(null)})]})})]}),e.jsx(he,{table:v,searchKey:"question_text"}),e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:v.getHeaderGroups().map(m=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50",children:m.headers.map(u=>e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:u.isPlaceholder?null:M(u.column.columnDef.header,u.getContext())},u.id))},m.id))}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:v.getRowModel().rows.map(m=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50",children:m.getVisibleCells().map(u=>e.jsx("td",{className:"p-4 align-middle",children:M(u.column.columnDef.cell,u.getContext())},u.id))},m.id))})]})}),e.jsx(xe,{table:v}),e.jsx(je,{table:v,entityName:"question",children:e.jsxs(b,{variant:"destructive",size:"sm",className:"h-8",onClick:()=>{const m=v.getFilteredSelectedRowModel().rows.map(u=>u.original.id);K.mutate({data:{ids:m}})},children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," Delete Selected"]})})]})}function Qe({questionnaire:r,questions:i}){const l=S(),c=Y({queryKey:["admin","questionnaire",r.id,"responses"],queryFn:()=>H({data:r.id})}),o=C({mutationFn:z,onSuccess:()=>{l.invalidateQueries({queryKey:["admin","questionnaires"]}),l.invalidateQueries({queryKey:["admin","questionnaire",r.id]}),x.success("Questionnaire updated successfully"),t.reset()},onError:()=>{x.error("Failed to update questionnaire")}}),t=F({defaultValues:{title:r.title,description:r.description||"",is_active:r.is_active},validators:{onSubmit:({value:s})=>{const n=oe.safeParse(s);if(!n.success)return n.error.issues.reduce((d,h)=>{const y=h.path[0];return d[y]=h.message,d},{})}},onSubmit:async({value:s})=>{await o.mutateAsync({data:{id:r.id,title:s.title,description:s.description||null,is_active:s.is_active}})}}),a=c.data??[];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{variant:"outline",size:"icon",asChild:!0,children:e.jsx(w,{to:"/admin/questionnaires",children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Questionnaire Details"})]}),e.jsxs(Z,{defaultValue:"details",className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(Q,{value:"details",children:"Details"}),e.jsxs(Q,{value:"questions",children:["Questions (",i.length,")"]}),e.jsxs(Q,{value:"responses",children:["Responses (",a.length,")"]})]}),e.jsx(_,{value:"details",className:"space-y-4",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),t.handleSubmit()},className:"space-y-4 rounded-lg border p-4",children:[e.jsx(t.Field,{name:"title",children:s=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"title",children:"Title"}),e.jsx(f,{id:"title",value:s.state.value,onBlur:s.handleBlur,onChange:n=>s.handleChange(n.target.value),required:!0}),s.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:s.state.meta.errors.join(", ")}):null]})}),e.jsx(t.Field,{name:"description",children:s=>e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"description",children:"Description"}),e.jsx(J,{id:"description",value:s.state.value,onBlur:s.handleBlur,onChange:n=>s.handleChange(n.target.value)}),s.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:s.state.meta.errors.join(", ")}):null]})}),e.jsx(t.Field,{name:"is_active",children:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{id:"is_active",checked:s.state.value,onCheckedChange:s.handleChange}),e.jsx(g,{htmlFor:"is_active",children:"Active"}),s.state.meta.errors?e.jsx("p",{className:"text-sm text-red-500",children:s.state.meta.errors.join(", ")}):null]})}),e.jsxs(b,{type:"submit",disabled:o.isPending,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Save Changes"]})]})})}),e.jsx(_,{value:"questions",className:"space-y-4",children:e.jsx("div",{className:"rounded-lg border p-4",children:e.jsx(Ce,{data:i,questionnaireId:r.id})})}),e.jsx(_,{value:"responses",className:"space-y-4",children:e.jsx("div",{className:"rounded-lg border",children:c.isLoading?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("span",{className:"text-muted-foreground",children:"Loading responses..."})}):a.length===0?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("span",{className:"text-muted-foreground",children:"No responses yet for this questionnaire"})}):e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(B,{children:[e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Class"}),e.jsx(j,{children:"NIM"}),e.jsx(j,{children:"Score"}),e.jsx(j,{children:"Video"}),e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(ae,{children:a.map(s=>e.jsxs(B,{children:[e.jsx(p,{className:"font-medium",children:s.profile?.name??"-"}),e.jsx(p,{children:e.jsx(q,{variant:"outline",children:s.profile?.class??"-"})}),e.jsx(p,{className:"text-muted-foreground",children:s.profile?.nim??"-"}),e.jsx(p,{children:e.jsx(q,{variant:"secondary",children:s.totalScore})}),e.jsx(p,{children:s.videoPath&&s.videoPath!=="null"?e.jsxs(q,{variant:"default",className:"gap-1",children:[e.jsx(ye,{className:"h-3 w-3"}),"Yes"]}):e.jsx(q,{variant:"outline",children:"No"})}),e.jsx(p,{className:"text-muted-foreground text-sm",children:Ne(new Date(s.createdAt),"dd MMM yyyy HH:mm")}),e.jsx(p,{children:e.jsx(w,{to:"/admin/responses/$responseId",params:{responseId:s.id},children:e.jsxs(b,{variant:"ghost",size:"sm",className:"cursor-pointer",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"View"]})})})]},s.id))})]})})})]})]})}function Ze(){const r=G.useParams(),i=D(T({queryKey:["admin","questionnaire",r.questionnaireId],queryFn:()=>U({data:r.questionnaireId})})),l=D(T({queryKey:["admin","questions",r.questionnaireId],queryFn:()=>W({data:r.questionnaireId})}));return e.jsx(Qe,{questionnaire:i.data,questions:l.data})}export{Ze as component};
